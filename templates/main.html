<!DOCTYPE html>
<html>
    <head>
        <title>Simple Map</title>
        <meta name="viewport" content="initial-scale=1.0">
        <meta charset="utf-8">
        <style>
            /* Always set the map height explicitly to define the size of the div
             * element that contains the map. */
            #map {
                height: 100%;
            }
            /* Optional: Makes the sample page fill the window. */
            html, body {
                height: 100%;
                margin: 0;
                padding: 0;
            }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script>
            var map;
            function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                    center: {lat: 40.717333, lng: -74.004814},
                    zoom: 12
                });

                var marker = new google.maps.Marker({
                    position: {lat: 40.717333, lng: -74.004814},
                    map: map,
                    title: 'Need 😷',
                    label: '🤯'
                });

                var infowindow = new google.maps.InfoWindow({
                    content: 'Need 😷'
                });
                marker.addListener('click', function() {
                    infowindow.open(map, marker);
                });

                addMarker();
            }

        async function addMarker() {
            var numMarkers = 0;
            var labels = ['❕', '💪'];
            var contents = ['Need 😷', 'Have 😷'];
            var names = ['Tai-Ying Chen', 'Donald Trumph']

            var infowindow = new google.maps.InfoWindow;
            while (numMarkers < 50) {
                await sleep(1000);
                var type = Math.round(Math.random());

                var infowincontent = document.createElement('div');
                var strong = document.createElement('strong');
                strong.textContent = names[type];
                infowincontent.appendChild(strong);
                infowincontent.appendChild(document.createElement('br'));

                var text = document.createElement('text');
                text.textContent = contents[type];
                infowincontent.appendChild(text);

                var marker = new google.maps.Marker({
                    position: {lat: 40.717333 + (Math.random()-0.5)/5, lng: -74.004814 + (Math.random()-0.5)/5},
                    map: map,
                    label: {
                            text: labels[type],
                            fontSize: '20px'
                    }
                });
                marker.addListener('click', function() {
                    infowindow.setContent(infowincontent);
                    infowindow.open(map, marker);
                });

                infowindow.setContent(infowincontent);
                infowindow.open(map, marker);

                numMarkers += 1;
            }
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key={{key}}&callback=initMap"
        async defer></script>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <!-- <script src="/__/firebase/7.13.1/firebase-app.js"></script> -->

        <!-- TODO: Add SDKs for Firebase products that you want to use
                https://firebase.google.com/docs/web/setup#available-libraries -->
        <!-- <script src="/__/firebase/7.13.1/firebase-analytics.js"></script> -->

        <!-- Initialize Firebase -->
        <!-- <script src="/__/firebase/init.js"></script> -->
    </body>
</html>